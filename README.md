# AI EPUB 翻译助手

这是一款专门为电子书（EPUB）设计的翻译工具。它能够在翻译内容的同时，精准保留原文件的所有排版、图片和文字样式。

---

### 1. 获取与运行方法

#### 方式 A：Windows 直接运行 (推荐)
1. **下载安装包**：前往 GitHub [Releases](https://github.com/31naitnij/AI-EPUB-Translator/releases) 页面。
2. **下载 `AI_EPUB_Translator_vX.Y.Z.zip`** 并解压。
3. **运行程序**：双击 **`EPUB_Translator.exe`** 即可，无需安装 Python。

#### 方式 B：源码构建 (适用于 Windows/macOS/Linux)
1. 克隆仓库：`git clone https://github.com/31naitnij/AI-EPUB-Translator.git`
2. 安装依赖：`pip install -r requirements.txt`
3. 执行构建：`python build.py` (生成文件位于 `dist/`)

---

### 2. 使用说明

- **顶部配置**：设置 EPUB 文件、API URL/Key 及模型名称。
- **任务列表**：点击“分块并分组”后，支持 Ctrl/Shift 多选任务进行批量处理。
- **编辑回填**：在右侧对照区修改译文后，点击“保存组修改”即可即时验证并回填至导出镜像。

---

### 3. 核心原理：锚点系统

为了让 AI 不受 HTML 代码干扰，我们使用以下标记：
- `[[n]]`：**行级锚点**，用于定位段落。
- `((X))`：**内部锚点**，用于保留加粗、链接等行内样式。

AI 仅需翻译文字并保留这些锚点，程序即可精准还原排版。

---

### 4. 格式错误与手动修复

当任务显示为 **红色** 时，代表格式校验未通过，该部分内容暂时不会回填到最终文档中。

| 错误类型 | 原因 | 处理方法 |
| :--- | :--- | :--- |
| **行数不匹配** | AI 合并或截断了段落 | 手动补全 `[[n]]` 标记，确保行数与原文一致。 |
| **分隔符不符** | `[[n]]` 标记损坏或不配对 | 检查并修复成对的 `[[n]]` 标签。 |
| **内部锚点不平衡** | `((A))` 标签未成对出现 | **A. 忽略**：直接导出，程序会自动清理错误标签并回填纯文本。<br>**B. 修复**：手动配对 `((A))` 标签以恢复样式。 |

**手动修复流程**：在右侧编辑器修改 -> 点击“保存组修改” -> 若颜色变回正常（透明），则表示回填成功。

---

### 5. AI 提示词建议

建议在 Prompt 中包含以下限制，以获得最佳格式稳定性：

```text
你是多语言翻译专家。
规则：
1. 输出行数必须与输入的 [[n]] 行数严格一致。
2. 保持每行 [[n]]...[[n]] 的闭合结构，不要中间换行。
3. 严格保留行内 ((A)) 样式锚点。
4. 直接输出翻译，不要任何注释。
```

---

### 6. 注意事项

- **文件占用**：翻译及导出前请关闭阅读器中的该文件，以免写入失败。
- **隐私提醒**：`config.json` 包含私密 API Key，请勿通过任何方式公开分发。
