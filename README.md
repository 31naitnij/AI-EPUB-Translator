# AI 文档翻译助手

这是一款专门为电子书（EPUB）和 Word 文档（DOCX）设计的翻译工具。它能够在翻译内容的同时，精准保留原文件的所有排版、图片和文字样式。

---

### 1. 获取与运行方法

您可以通过以下几种方式使用本工具：

*   **下载使用**：在 GitHub 的 `Release` 页面下载最新压缩包，解压后双击运行 **`run.bat`** 即可启动。
*   **源码运行**：
    1.  确保电脑已安装 Python 3.10 或更高版本。
    2.  在终端执行 `pip install -r requirements.txt` 安装依赖。
    3.  执行 `python main.py` 启动程序。
*   **自行构建**：如果您需要将其打包为独立的可执行文件，可以运行脚本 `build_exe.bat` (Windows) 或 `build_macos.sh` (macOS)。

---

### 2. 使用说明

工具界面简洁直观，主要分为以下三个区域：

*   **顶部配置区**：在这里选择您需要翻译的文件，并填写 AI 服务的地址、密钥和模型名称。您还可以调整“分块字符数”（建议 1000-1500），这决定了每次交给 AI 处理的文字量。
*   **左侧任务区**：点击“分块并分组”后，程序会将整本书拆分成多个任务块。在此可以查看翻译进度，并支持通过 Ctrl/Shift 键多选任务进行批量处理。
*   **右侧对照区**：选中一个任务后，右侧会显示原文与译文的对照。您可以直接编辑译文，修改后点击“保存组修改”即可即时保存。

---

### 3. 工作流程简介

本工具遵循一套严谨的处理流程，确保文档安全：
1.  **解压缩**：将电子书或文档拆解为原始的文本和图片资源。
2.  **分块**：将长篇文字切分为适合 AI 处理的短句和段落。
3.  **抽取**：剥离复杂的排版代码，仅提取需要翻译的纯文本。
4.  **翻译**：通过 AI 服务将英文转换为中文。
5.  **回填**：根据标记将中文精准放回原有的排版位置。
6.  **打包**：重新封装文件，生成排版完美的中文文档。

---

### 4. 关键步骤原理

*   **抽取与回填**：为了让 AI 不被复杂的排版代码干扰，我们使用 `[[n]]` 标记行号，用 `((A))` 标记文字样式（如加粗或链接）。AI 翻译时只需保持标记不动，程序就能在“回填”时根据标记自动复原样式。
*   **颜色标记说明**：
    *   ⚪ **白色**：待处理的任务。
    *   ✅ **绿色**：翻译成功并已保存。
    *   🔴 **红色**：格式检测有误。这通常是因为 AI 在翻译时漏写了标记。此时编辑器会自动以红底高亮错误位置，方便您手动修正。

---

### 5. 注意事项

*   **AI 提示词设置**：建议在提示词中包含以下内容（您可以直接将其复制到工具的“Prompt”框中）：

```text
你是多语言翻译专家，将以下文本中的英文翻译为中文。
规则：
1. **行数一致**：输出的行数必须与输入的行数严格一致，不可合并、拆分。每一行被 [[n]] 包裹（如 [[1]]文本[[1]]），确保成对出现，不要中间换行。
2. **锚点保留**：严格保留每行内字母编号的锚点符号（如 ((A))文字((A))）的相对位置，确保成对出现，严禁修改。
3. **简洁输出**：直接输出翻译内容，不要有任何额外注释。

示例：
[[1]]I woke up late this morning,[[1]]
[[2]]I missed ((A))the bus((A)) to school.[[2]]
->
[[1]]我今天早上起晚了，[[1]]
[[2]]我错过了去学校的((A))公交车((A))。[[2]]
```
*   **格式不匹配的处理**：如果出现任务标红，通常是因为 AI 合并了段落。此时您可以尝试重新点击翻译，或根据红色背景提示手动补全缺失的标记并保存。
*   **文件被占用**：启动翻译前，请关闭正在展示该文件的软件（如 Word 或电子书阅读器），以防保存失败。
*   **格式支持**：目前暂不支持 PDF。建议先将 PDF 转换为 DOCX 后再使用本工具。

希望本工具能为您的文档阅读工作带来便利。
